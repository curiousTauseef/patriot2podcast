# patriot2podcast

태어나지 말았어야 할 다음 스토리펀딩 오디오 피드 -> 팟캐스트 피드 변환 스크립트.

## 만든 이유

과거 다음 스토리펀딩 중 열심히 찾아듣던 프로젝트가 웹페이지를 통해서만 오디오 피드를 들을 수 있게 되어 있어서,  
(저작권, 계약 등등은 알지도 못하고) 팟캐스트 앱으로 들을 수 있으면 편하겠다 싶었다.  

(저작권자가 아니지만...) 기왕 만드는 거 아이튠즈, 팟빵 등에 올리면 더 좋겠다 싶었다.

## 동작 개요

Python3 및 아래 package를 이용했다.  
 - BeautifulSoup4 (beautifulsoup4): HTML 페이지 구문 분석기
 - feedgen: XML 피드 생성기
 - python-dateutil, pytz: XML 피드에서 KST로 날짜, 시간 표현

아이튠즈 업로드가 최종 목표였으나, 팟빵만 처리할 수 있는 상태에서 그만뒀었다. 전체 절차는,  
 - 프로젝트 페이지 구문 분석
   - (오디오가 포함된) 새 에피소드가 있으면 목록에 추가
 - (새 에피소드가 있으면) 새 피드 파일 생성
   - CloudFlare에 피드 파일 캐시 새로고침 요청
   - 몇 초 기다린 후, 팟빵에 피드 파일 업데이트 알림

### 서비스 이용
#### 원래 웹페이지
염치 불구하고...
 - 프로젝트 웹페이지를 읽어서 새 에피소드 획득
 - 오디오 파일 링크 따서 그대로 (......) 이용
   - 팟캐스트 운영할 때, 오디오 파일 트래픽 비용이 제일 비싸다던데...

#### CloudFlare
Page Rule을 이용해 아래와 같은 기능을 활용했다.  
 - 팟캐스트 피드 파일 캐싱
 - 피드 파일에 적어둔 가짜 오디오 파일 URL을 진짜 파일 URL로 리디렉션
   - URL이 바뀔 경우 대비
   - 당시 아이튠즈에서 URL 끝에 확장자가 안 붙어 있으면 오디오 파일인 줄 모르던 문제 회피

#### 팟빵
피드 페이지에 피드 새로고침 버튼이 있길래 활용.  

#### VPS
요렇게 구성되면, 남은 것은 일정 시간마다 스크립트를 돌려 줄 VPS 서버 뿐이다.  
cron으로 적정 시간마다 스크립트가 돌아가게 해 뒀다. 코드에는 없으나, 트래픽 부담을 줄이기 위해 실행 시간을 랜덤화하는 것이 매우 중요하겠다.  

## 그러나...
저작권자도 아니고 해당 프로젝트 웹 사이트에서 듣도록 되어 있는 에피소드를 웹페이지 방문 없이 듣도록 했으니, 잘리는 것은 당연지사.  

## 배운 점
팟캐스트 피드가 별 건 없으나, 갖가지 클라이언트에서 (특히 아이튠즈) 올바르게 인식하도록 피드가 올바른 문법으로 작성되도록 만드는 일이 쉽지 않았다.

